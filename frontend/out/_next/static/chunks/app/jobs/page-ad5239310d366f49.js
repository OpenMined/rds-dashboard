(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[531],{17576:(e,s,r)=>{"use strict";r.d(s,{A:()=>t});let t=(0,r(19946).A)("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]])},79050:(e,s,r)=>{Promise.resolve().then(r.bind(r,80236))},80236:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>ed});var t=r(95155),a=r(97168),l=r(88482),d=r(88145),n=r(62525),o=r(17576),i=r(19946);let c=(0,i.A)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var x=r(5196),h=r(54416);let u=(0,i.A)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]),m=(0,i.A)("rotate-cw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);var b=r(57497),g=r(53999),j=r(22235);let v={getJob:e=>j.u.get("/api/v1/jobs/".concat(e)),approveJob:e=>j.u.post("/api/v1/jobs/approve/".concat(e),{}),rejectJob:e=>j.u.post("/api/v1/jobs/reject/".concat(e),{}),runJob:e=>j.u.post("/api/v1/jobs/run/".concat(e),{}),rerunJob:e=>j.u.post("/api/v1/jobs/rerun/".concat(e),{}),getJobLogs:e=>j.u.get("/api/v1/jobs/logs/".concat(e)),getJobCode:e=>j.u.get("/api/v1/jobs/code/".concat(e)),getJobOutput:e=>j.u.get("/api/v1/jobs/output/".concat(e)),deleteJob:e=>j.u.delete("/api/v1/jobs/".concat(e)),deleteAllJobs:()=>j.u.delete("/api/v1/jobs")};var p=r(50883),f=r(26715),y=r(5041),N=r(32960),w=r(27737),k=r(12115),A=r(99840),F=r(16891),C=r(34964);let S=(0,i.A)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);var E=r(24357),_=r(53904),T=r(56671);function q(e){let{content:s}=e,r=s.split("\n");return(0,t.jsx)("div",{children:r.map((e,s)=>(0,t.jsx)("div",{children:(e=>{let s=[],r=e,t=[{regex:/(\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}:\d{2}\.\d+)/,color:"text-cyan-400"},{regex:/\bINFO\b/,color:"text-green-400"},{regex:/\bDEBUG\b/,color:"text-purple-400"},{regex:/\bWARNING\b/,color:"text-yellow-400"},{regex:/\bERROR\b/,color:"text-red-400"},{regex:/\bFATAL\b/,color:"text-red-600"},{regex:/([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/,color:"text-blue-300"},{regex:/(\/[\w\/\-\.]+)/,color:"text-blue-400"},{regex:/\b(\d+\.?\d*)\b/,color:"text-yellow-300"},{regex:/(\||->|â†|â†’|âš¡|ðŸ”’|ðŸ”“|ðŸ“|âœ“|âœ—|@)/,color:"text-gray-500"}];for(;r.length>0;){let e=!1;for(let a of t){let t=r.match(a.regex);if(t&&0===t.index){s.push({text:t[0],color:a.color}),r=r.slice(t[0].length),e=!0;break}}e||(s.push({text:r[0],color:"text-slate-50"}),r=r.slice(1))}return s})(e).map((e,s)=>(0,t.jsx)("span",{className:e.color,children:e.text},s))},s))})}function z(e){let{job:s}=e,[r,l]=(0,k.useState)(!1),[d,n]=(0,k.useState)("stdout"),[o,i]=(0,k.useState)(!1),[c,h]=(0,k.useState)(!1),{data:u,refetch:m,isRefetching:b}=(0,N.I)({queryKey:["job-logs",s.uid],queryFn:()=>v.getJobLogs(s.uid),enabled:r,refetchInterval:"running"===s.status&&p.c.REFETCH_INTERVAL,staleTime:0,gcTime:0}),g=async()=>{let e="stdout"===d?null==u?void 0:u.stdout:null==u?void 0:u.stderr;if(!e)return void T.oR.error("No logs to copy");try{await navigator.clipboard.writeText(e),i(!0),T.oR.success("Copied ".concat("stdout"===d?"stdout":"stderr"," logs to clipboard")),setTimeout(()=>i(!1),2e3)}catch(e){T.oR.error("Failed to copy logs")}},j=async e=>{try{await navigator.clipboard.writeText(e),h(!0),T.oR.success("Copied logs directory path to clipboard"),setTimeout(()=>h(!1),2e3)}catch(e){T.oR.error("Failed to copy directory path")}};return(0,t.jsxs)(A.lG,{open:r,onOpenChange:l,children:[(0,t.jsx)(A.zM,{asChild:!0,children:(0,t.jsxs)(a.$,{size:"sm",className:"w-full h-7 text-xs border border-black bg-white text-gray-700 hover:bg-gray-100 hover:text-gray-900 hover:border-gray-700 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:hover:bg-gray-800",children:[(0,t.jsx)(S,{className:"mr-2 h-4 w-4"}),"View Logs"]})}),(0,t.jsxs)(A.Cf,{className:"!max-w-[50vw] !max-h-[90vh] !w-[50vw] !h-[90vh] p-5 !gap-0",children:[(0,t.jsx)(A.c7,{className:"!gap-1 !space-y-0 !mb-0",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(A.L3,{children:["Job Logs: ",s.projectName]}),(0,t.jsx)(A.rr,{className:"!mb-0",children:"View stdout and stderr output from the job execution"})]}),(0,t.jsxs)("div",{className:"flex gap-2 mr-6",children:[(0,t.jsx)(a.$,{variant:"outline",size:"icon",onClick:g,disabled:!u,title:"Copy ".concat("stdout"===d?"stdout":"stderr"," logs"),children:o?(0,t.jsx)(x.A,{className:"h-4 w-4 text-green-500"}):(0,t.jsx)(E.A,{className:"h-4 w-4"})}),(0,t.jsx)(a.$,{variant:"outline",size:"icon",onClick:()=>m(),disabled:b,title:"Refresh logs",children:(0,t.jsx)(_.A,{className:"h-4 w-4 ".concat(b?"animate-spin":"")})})]})]})}),(0,t.jsxs)(C.tU,{defaultValue:"stdout",value:d,onValueChange:n,className:"w-full overflow-hidden !mt-0",children:[(0,t.jsxs)(C.j7,{className:"!grid w-full grid-cols-2 !mt-0",children:[(0,t.jsx)(C.Xi,{value:"stdout",className:"!flex-1",children:"Standard Output"}),(0,t.jsx)(C.Xi,{value:"stderr",className:"!flex-1",children:"Standard Error"})]}),(0,t.jsx)(C.av,{value:"stdout",className:"mt-1",children:(0,t.jsx)("div",{className:"h-[calc(90vh-150px)] w-full rounded-md border bg-slate-950 overflow-hidden",children:(0,t.jsx)(F.F,{className:"h-full w-full",children:(0,t.jsx)("div",{className:"p-4",style:{maxWidth:"100%",overflow:"hidden"},children:(0,t.jsx)("pre",{className:"text-xs text-slate-50 font-mono whitespace-pre-wrap",style:{overflowWrap:"anywhere",wordBreak:"break-word"},children:(null==u?void 0:u.stdout)?(0,t.jsx)(q,{content:u.stdout}):"No stdout logs available"})})})})}),(0,t.jsx)(C.av,{value:"stderr",className:"!mt-1",children:(0,t.jsx)("div",{className:"h-[calc(90vh-150px)] w-full rounded-md border bg-slate-950 overflow-hidden",children:(0,t.jsx)(F.F,{className:"h-full w-full",children:(0,t.jsx)("div",{className:"p-4",style:{maxWidth:"100%",overflow:"hidden"},children:(0,t.jsx)("pre",{className:"text-xs text-slate-50 font-mono whitespace-pre-wrap",style:{overflowWrap:"anywhere",wordBreak:"break-word"},children:(null==u?void 0:u.stderr)?(0,t.jsx)(q,{content:u.stderr}):"No stderr logs available"})})})})})]}),(null==u?void 0:u.logs_dir)&&(0,t.jsxs)("div",{className:"flex items-start gap-2 text-xs mt-2",children:[(0,t.jsx)("span",{className:"text-muted-foreground font-medium",children:"Logs directory:"}),(0,t.jsx)("span",{className:"flex-1 break-all text-blue-500 underline",children:u.logs_dir}),(0,t.jsx)(a.$,{variant:"ghost",size:"sm",className:"h-6 px-2 flex-shrink-0",onClick:()=>j(u.logs_dir),children:c?(0,t.jsx)(x.A,{className:"h-3 w-3 text-green-500"}):(0,t.jsx)(E.A,{className:"h-3 w-3"})})]})]})]})}var J=r(37777);let R=(0,i.A)("circle-dashed",[["path",{d:"M10.1 2.182a10 10 0 0 1 3.8 0",key:"5ilxe3"}],["path",{d:"M13.9 21.818a10 10 0 0 1-3.8 0",key:"11zvb9"}],["path",{d:"M17.609 3.721a10 10 0 0 1 2.69 2.7",key:"1iw5b2"}],["path",{d:"M2.182 13.9a10 10 0 0 1 0-3.8",key:"c0bmvh"}],["path",{d:"M20.279 17.609a10 10 0 0 1-2.7 2.69",key:"1ruxm7"}],["path",{d:"M21.818 10.1a10 10 0 0 1 0 3.8",key:"qkgqxc"}],["path",{d:"M3.721 6.391a10 10 0 0 1 2.7-2.69",key:"1mcia2"}],["path",{d:"M6.391 20.279a10 10 0 0 1-2.69-2.7",key:"1fvljs"}]]),L=(0,i.A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),M=(0,i.A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var O=r(51154);let I=(0,i.A)("check-check",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]),$=(0,i.A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);function D(e){let{jobStatus:s}=e,r={pending:R,approved:L,rejected:M,running:O.A,finished:I,failed:$}[s];return(0,t.jsxs)(J.m_,{children:[(0,t.jsx)(J.k$,{asChild:!0,children:(0,t.jsxs)(d.E,{className:(0,g.cn)({pending:"border-yellow-300 bg-yellow-50 text-yellow-600 dark:border-yellow-900 dark:bg-yellow-900/30 dark:text-yellow-400 hover:bg-yellow-100 hover:border-yellow-400 hover:text-yellow-700 dark:hover:bg-yellow-900/30",approved:"border-emerald-300 bg-emerald-50 text-emerald-600 dark:border-emerald-900 dark:bg-emerald-900/30 dark:text-emerald-400 hover:bg-emerald-100 hover:border-emerald-400 hover:text-emerald-700 dark:hover:bg-emerald-900/30",rejected:"border-red-200 bg-red-50 text-red-600 dark:border-red-900 dark:bg-red-900/30 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30",running:"border-blue-300 bg-blue-50 text-blue-600 dark:border-blue-900 dark:bg-blue-900/30 dark:text-blue-400 hover:bg-blue-100 hover:border-blue-400 hover:text-blue-700 dark:hover:bg-blue-900/30",finished:"border-green-300 bg-green-50 text-green-600 dark:border-green-900 dark:bg-green-900/30 dark:text-green-400 hover:bg-green-100 hover:border-green-400 hover:text-green-700 dark:hover:bg-green-900/30",failed:"border-orange-300 bg-orange-50 text-orange-600 dark:border-orange-900 dark:bg-orange-900/30 dark:text-orange-400 hover:bg-orange-100 hover:border-orange-400 hover:text-orange-700 dark:hover:bg-orange-900/30"}[s],"cursor-default gap-2 transition","running"===s&&"animate-pulse"),children:[(0,t.jsx)(r,{className:(0,g.cn)("running"===s&&"animate-spin")}),s]})}),(0,t.jsx)(J.ZI,{children:{pending:"This job is pending execution",approved:"This job has been approved and is ready to run",rejected:"This job has been rejected",running:"This job is currently running",finished:"This job has finished successfully",failed:"This job has failed"}[s]})]})}function V(e){let{job:s,children:r}=e,[a,l]=(0,k.useState)(!1),{data:n,isLoading:o}=(0,N.I)({queryKey:["job-details",s.uid],queryFn:()=>v.getJob(s.uid),enabled:a});return(0,t.jsxs)(A.lG,{open:a,onOpenChange:l,children:[(0,t.jsx)(A.zM,{asChild:!0,children:r}),(0,t.jsxs)(A.Cf,{className:"max-w-2xl max-h-[80vh] flex flex-col overflow-hidden",children:[(0,t.jsxs)(A.c7,{children:[(0,t.jsx)(A.L3,{children:"Job Details"}),(0,t.jsxs)(A.rr,{children:["Complete metadata for job ",s.uid]})]}),o?(0,t.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Loading..."}):(0,t.jsx)(F.F,{className:"max-h-[calc(80vh-180px)] w-full rounded-md border p-4 overflow-auto",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(K,{label:"Job Name",value:(null==n?void 0:n.name)||"N/A"}),(0,t.jsx)(K,{label:"Description",value:(null==n?void 0:n.description)||"N/A"}),(0,t.jsx)(K,{label:"Status",value:(0,t.jsx)(D,{jobStatus:s.status})}),(0,t.jsx)(K,{label:"UID",value:null==n?void 0:n.uid,mono:!0}),(0,t.jsx)(K,{label:"Dataset Name",value:null==n?void 0:n.dataset_name}),(0,t.jsx)(K,{label:"Requester Email",value:null==n?void 0:n.requester_email}),(null==n?void 0:n.tags)&&n.tags.length>0&&(0,t.jsx)(K,{label:"Tags",value:(0,t.jsx)("div",{className:"flex flex-wrap gap-1",children:n.tags.map(e=>(0,t.jsx)(d.E,{variant:"secondary",className:"text-xs",children:e},e))})}),(0,t.jsx)(K,{label:"Created At",value:(null==n?void 0:n.created_at)?new Date(n.created_at).toLocaleString():"N/A"}),(0,t.jsx)(K,{label:"Updated At",value:(null==n?void 0:n.updated_at)?new Date(n.updated_at).toLocaleString():"N/A"}),(null==n?void 0:n.user_code_id)&&(0,t.jsx)(K,{label:"User Code ID",value:n.user_code_id,mono:!0}),(null==n?void 0:n.custom_function_id)&&(0,t.jsx)(K,{label:"Custom Function ID",value:n.custom_function_id,mono:!0}),(null==n?void 0:n.runtime_id)&&(0,t.jsx)(K,{label:"Runtime ID",value:n.runtime_id,mono:!0}),(null==n?void 0:n.enclave)&&(0,t.jsx)(K,{label:"Enclave",value:n.enclave}),(null==n?void 0:n.error)&&(0,t.jsx)(K,{label:"Error",value:n.error,className:"text-red-600 dark:text-red-400"}),(null==n?void 0:n.error_message)&&(0,t.jsx)(K,{label:"Error Message",value:n.error_message,className:"text-red-600 dark:text-red-400"}),(0,t.jsx)(K,{label:"Output URL",value:(null==n?void 0:n.output_url)||"N/A",mono:!0})]})})]})]})}function K(e){let{label:s,value:r,mono:a=!1,className:l=""}=e;return(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4 py-2 border-b border-border last:border-0",children:[(0,t.jsx)("div",{className:"font-medium text-sm text-muted-foreground",children:s}),(0,t.jsx)("div",{className:"col-span-2 text-sm break-all ".concat(a?"font-mono":""," ").concat(l),children:r})]})}let W=(0,i.A)("code-xml",[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]]);var H=r(21380),P=r(66474),Z=r(13052),U=r(99890),G=r(99903);function Q(e){let{job:s,children:r}=e,[l,d]=(0,k.useState)(!1),[n,o]=(0,k.useState)(null),[i,c]=(0,k.useState)(new Set),[h,u]=(0,k.useState)(!1),{data:m,isLoading:b}=(0,N.I)({queryKey:["job-code",s.uid],queryFn:()=>v.getJobCode(s.uid),enabled:l}),g=(null==m?void 0:m.files)||{},j=Object.keys(g).sort(),p=function(e){let s=[];return e.forEach(e=>{let r=e.split("/"),t=s;r.forEach((e,s)=>{let a=s===r.length-1,l=r.slice(0,s+1).join("/"),d=t.find(s=>s.name===e);if(!d){let s={name:e,path:l,type:a?"file":"folder",children:a?void 0:[]};t.push(s),d=s}!a&&d.children&&(t=d.children)})}),s}(j);(0,k.useEffect)(()=>{!(j.length>0)||n||b||o(j[0])},[j.length,n,b]);let f=async e=>{try{await navigator.clipboard.writeText(e),u(!0),setTimeout(()=>u(!1),2e3)}catch(e){console.error("Failed to copy:",e)}};return(0,t.jsxs)(A.lG,{open:l,onOpenChange:d,children:[(0,t.jsx)(A.zM,{asChild:!0,children:r||(0,t.jsxs)(a.$,{size:"sm",className:"w-full h-7 text-xs border border-black bg-white text-gray-700 hover:bg-gray-100 hover:text-gray-900 hover:border-gray-700 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:hover:bg-gray-800",children:[(0,t.jsx)(W,{className:"mr-2 h-4 w-4"}),"View Code"]})}),(0,t.jsxs)(A.Cf,{className:"!max-w-[50vw] !max-h-[90vh] !w-[50vw] !h-[90vh] p-4",children:[(0,t.jsxs)(A.c7,{children:[(0,t.jsxs)(A.L3,{children:["Job Code: ",s.projectName]}),(0,t.jsx)(A.rr,{children:"View the code files submitted for this job"})]}),(0,t.jsxs)("div",{className:"flex gap-4 h-[calc(90vh-160px)] overflow-hidden",children:[(0,t.jsxs)("div",{className:"w-56 border-r pr-4 flex-shrink-0 flex flex-col",children:[(0,t.jsxs)("div",{className:"text-xs font-semibold mb-2 text-muted-foreground flex items-center gap-1",children:[(0,t.jsx)(H.A,{className:"h-3 w-3"}),"Files"]}),(0,t.jsx)(F.F,{className:"flex-1",children:b?(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Loading files..."}):0===j.length?(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"No files found"}):(0,t.jsx)(B,{nodes:p,selectedFile:n,expandedFolders:i,onSelectFile:o,onToggleFolder:e=>{c(s=>{let r=new Set(s);return r.has(e)?r.delete(e):r.add(e),r})},level:0})})]}),(0,t.jsx)("div",{className:"flex-1 min-w-0 overflow-hidden",children:n&&n in g?(0,t.jsxs)("div",{className:"h-full flex flex-col overflow-hidden",children:[(0,t.jsx)("div",{className:"text-xs font-medium mb-2 text-muted-foreground",children:n}),(0,t.jsx)("div",{className:"flex-1 rounded-md border bg-slate-950 overflow-hidden",children:(0,t.jsx)(F.F,{className:"h-full w-full",children:(0,t.jsx)("div",{className:"p-4",style:{maxWidth:"100%",overflow:"hidden"},children:g[n]?(0,t.jsx)(G.X,{code:g[n],filePath:n}):(0,t.jsx)("div",{className:"text-muted-foreground text-xs italic",children:"This file is empty"})})})})]}):(0,t.jsx)("div",{className:"h-full flex items-center justify-center text-muted-foreground text-sm",children:b?"Loading code...":"Select a file to view its contents"})})]}),(null==m?void 0:m.code_dir)&&(0,t.jsxs)("div",{className:"flex items-start gap-2 text-xs mt-2",children:[(0,t.jsx)("span",{className:"text-muted-foreground font-medium",children:"Code directory:"}),(0,t.jsx)("span",{className:"flex-1 break-all text-blue-500 underline",children:m.code_dir}),(0,t.jsx)(a.$,{variant:"ghost",size:"sm",className:"h-6 px-2 flex-shrink-0",onClick:()=>f(m.code_dir),children:h?(0,t.jsx)(x.A,{className:"h-3 w-3 text-green-500"}):(0,t.jsx)(E.A,{className:"h-3 w-3"})})]})]})]})}function B(e){let{nodes:s,selectedFile:r,expandedFolders:a,onSelectFile:l,onToggleFolder:d,level:n}=e;return(0,t.jsx)("div",{className:"space-y-0.5",children:s.map(e=>(0,t.jsx)("div",{children:"folder"===e.type?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("button",{onClick:()=>d(e.path),className:"w-full text-left text-xs px-2 py-1.5 rounded hover:bg-accent/50 transition-colors flex items-center gap-1",style:{paddingLeft:"".concat(12*n+8,"px")},children:[a.has(e.path)?(0,t.jsx)(P.A,{className:"h-3 w-3 flex-shrink-0"}):(0,t.jsx)(Z.A,{className:"h-3 w-3 flex-shrink-0"}),(0,t.jsx)(H.A,{className:"h-3 w-3 flex-shrink-0 text-blue-500"}),(0,t.jsx)("span",{className:"truncate font-medium",children:e.name})]}),a.has(e.path)&&e.children&&(0,t.jsx)(B,{nodes:e.children,selectedFile:r,expandedFolders:a,onSelectFile:l,onToggleFolder:d,level:n+1})]}):(0,t.jsxs)("button",{onClick:()=>l(e.path),className:(0,g.cn)("w-full text-left text-xs px-2 py-1.5 rounded hover:bg-accent transition-colors flex items-center gap-1",r===e.path&&"bg-accent font-medium"),style:{paddingLeft:"".concat(12*n+8,"px")},children:[(0,t.jsx)(U.A,{className:"h-3 w-3 flex-shrink-0 text-gray-500"}),(0,t.jsx)("span",{className:"truncate",children:e.name})]})},e.path))})}let X=(0,i.A)("folder-output",[["path",{d:"M2 7.5V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-1.5",key:"1yk7aj"}],["path",{d:"M2 13h10",key:"pgb2dq"}],["path",{d:"m5 10-3 3 3 3",key:"1r8ie0"}]]);function Y(e){let{job:s,children:r}=e,[l,d]=(0,k.useState)(!1),[n,o]=(0,k.useState)(null),[i,c]=(0,k.useState)(new Set),[h,u]=(0,k.useState)(!1),{data:m,isLoading:b,refetch:g,isRefetching:j}=(0,N.I)({queryKey:["job-output",s.uid],queryFn:()=>v.getJobOutput(s.uid),enabled:l,refetchInterval:"running"===s.status&&p.c.REFETCH_INTERVAL,staleTime:0,gcTime:0}),f=(null==m?void 0:m.files)||{},y=Object.keys(f).sort(),w=function(e){let s=[];return e.forEach(e=>{let r=e.split("/"),t=s;r.forEach((e,s)=>{let a=s===r.length-1,l=r.slice(0,s+1).join("/"),d=t.find(s=>s.name===e);if(!d){let s={name:e,path:l,type:a?"file":"folder",children:a?void 0:[]};t.push(s),d=s}!a&&d.children&&(t=d.children)})}),s}(y);(0,k.useEffect)(()=>{!(y.length>0)||n||b||o(y[0])},[y.length,n,b]);let C=async e=>{try{await navigator.clipboard.writeText(e),u(!0),setTimeout(()=>u(!1),2e3)}catch(e){console.error("Failed to copy:",e)}};return(0,t.jsxs)(A.lG,{open:l,onOpenChange:d,children:[(0,t.jsx)(A.zM,{asChild:!0,children:r||(0,t.jsxs)(a.$,{size:"sm",className:"w-full h-7 text-xs border border-black bg-white text-gray-700 hover:bg-gray-100 hover:text-gray-900 hover:border-gray-700 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 dark:hover:bg-gray-800",children:[(0,t.jsx)(X,{className:"mr-2 h-4 w-4"}),"View Output"]})}),(0,t.jsxs)(A.Cf,{className:"!max-w-[50vw] !max-h-[90vh] !w-[50vw] !h-[90vh] p-4",children:[(0,t.jsx)(A.c7,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(A.L3,{children:["Job Output: ",s.projectName]}),(0,t.jsx)(A.rr,{children:"View the output files generated by this job"})]}),(0,t.jsx)(a.$,{variant:"outline",size:"icon",onClick:()=>g(),disabled:j,title:"Refresh output files",className:"mr-6",children:(0,t.jsx)(_.A,{className:"h-4 w-4 ".concat(j?"animate-spin":"")})})]})}),(0,t.jsxs)("div",{className:"flex gap-4 h-[calc(90vh-180px)] overflow-hidden",children:[(0,t.jsxs)("div",{className:"w-56 border-r pr-4 flex-shrink-0 flex flex-col",children:[(0,t.jsxs)("div",{className:"text-xs font-semibold mb-2 text-muted-foreground flex items-center gap-1",children:[(0,t.jsx)(H.A,{className:"h-3 w-3"}),"Files"]}),(0,t.jsx)(F.F,{className:"flex-1",children:b?(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Loading files..."}):0===y.length?(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"No output files found"}):(0,t.jsx)(ee,{nodes:w,selectedFile:n,expandedFolders:i,onSelectFile:o,onToggleFolder:e=>{c(s=>{let r=new Set(s);return r.has(e)?r.delete(e):r.add(e),r})},level:0})})]}),(0,t.jsx)("div",{className:"flex-1 min-w-0 overflow-hidden",children:n&&n in f?(0,t.jsxs)("div",{className:"h-full flex flex-col overflow-hidden",children:[(0,t.jsx)("div",{className:"text-xs font-medium mb-2 text-muted-foreground",children:n}),(0,t.jsx)("div",{className:"flex-1 rounded-md border bg-slate-950 overflow-hidden",children:(0,t.jsx)(F.F,{className:"h-full w-full",children:(0,t.jsx)("div",{className:"p-4",style:{maxWidth:"100%",overflow:"hidden"},children:f[n]?(0,t.jsx)(G.X,{code:f[n],filePath:n}):(0,t.jsx)("div",{className:"text-muted-foreground text-xs italic",children:"This file is empty"})})})})]}):(0,t.jsx)("div",{className:"h-full flex items-center justify-center text-muted-foreground text-sm",children:b?"Loading output...":"Select a file to view its contents"})})]}),(null==m?void 0:m.output_dir)&&(0,t.jsxs)("div",{className:"flex items-start gap-2 text-xs mt-2",children:[(0,t.jsx)("span",{className:"text-muted-foreground font-medium",children:"Output directory:"}),(0,t.jsx)("span",{className:"flex-1 break-all text-blue-500 underline",children:m.output_dir}),(0,t.jsx)(a.$,{variant:"ghost",size:"sm",className:"h-6 px-2 flex-shrink-0",onClick:()=>C(m.output_dir),children:h?(0,t.jsx)(x.A,{className:"h-3 w-3 text-green-500"}):(0,t.jsx)(E.A,{className:"h-3 w-3"})})]})]})]})}function ee(e){let{nodes:s,selectedFile:r,expandedFolders:a,onSelectFile:l,onToggleFolder:d,level:n}=e;return(0,t.jsx)("div",{className:"space-y-0.5",children:s.map(e=>(0,t.jsx)("div",{children:"folder"===e.type?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("button",{onClick:()=>d(e.path),className:"w-full text-left text-xs px-2 py-1.5 rounded hover:bg-accent/50 transition-colors flex items-center gap-1",style:{paddingLeft:"".concat(12*n+8,"px")},children:[a.has(e.path)?(0,t.jsx)(P.A,{className:"h-3 w-3 flex-shrink-0"}):(0,t.jsx)(Z.A,{className:"h-3 w-3 flex-shrink-0"}),(0,t.jsx)(H.A,{className:"h-3 w-3 flex-shrink-0 text-blue-500"}),(0,t.jsx)("span",{className:"truncate font-medium",children:e.name})]}),a.has(e.path)&&e.children&&(0,t.jsx)(ee,{nodes:e.children,selectedFile:r,expandedFolders:a,onSelectFile:l,onToggleFolder:d,level:n+1})]}):(0,t.jsxs)("button",{onClick:()=>l(e.path),className:(0,g.cn)("w-full text-left text-xs px-2 py-1.5 rounded hover:bg-accent transition-colors flex items-center gap-1",r===e.path&&"bg-accent font-medium"),style:{paddingLeft:"".concat(12*n+8,"px")},children:[(0,t.jsx)(U.A,{className:"h-3 w-3 flex-shrink-0 text-gray-500"}),(0,t.jsx)("span",{className:"truncate",children:e.name})]})},e.path))})}var es=r(16559);function er(){return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Jobs"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Manage data access requests and research projects"})]}),(0,t.jsx)(et,{})]}),(0,t.jsx)(ea,{})]})}function et(){let[e,s]=(0,k.useState)(!1),r=(0,f.jE)(),l=(0,y.n)({mutationFn:()=>v.deleteAllJobs(),onSuccess:e=>{r.invalidateQueries({queryKey:["jobs"]}),T.oR.success("Successfully deleted ".concat(e.count," job(s)")),s(!1)},onError:e=>{T.oR.error("Failed to delete jobs: ".concat(e.message))}});return(0,t.jsxs)(es.Lt,{open:e,onOpenChange:s,children:[(0,t.jsx)(es.tv,{asChild:!0,children:(0,t.jsxs)(a.$,{variant:"destructive",size:"sm",children:[(0,t.jsx)(n.A,{className:"mr-2 h-4 w-4"}),"Delete All Jobs"]})}),(0,t.jsxs)(es.EO,{children:[(0,t.jsxs)(es.wd,{children:[(0,t.jsx)(es.r7,{children:"Are you absolutely sure?"}),(0,t.jsx)(es.$v,{children:"This will permanently delete all jobs and their associated data (logs, outputs, and user code). This action cannot be undone."})]}),(0,t.jsxs)(es.ck,{children:[(0,t.jsx)(es.Zr,{children:"Cancel"}),(0,t.jsx)(es.Rx,{onClick:()=>{l.mutate()},disabled:l.isPending,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:l.isPending?"Deleting...":"Delete All"})]})]})]})}function ea(){let e=(0,N.I)({queryKey:["jobs"],queryFn:async()=>await b.K.getJobs(),refetchInterval:p.c.REFETCH_INTERVAL,refetchOnWindowFocus:p.c.REFETCH_ON_WINDOW_FOCUS}),s=(0,f.jE)(),r=(0,y.n)({mutationFn:e=>v.approveJob(e),onSuccess:()=>s.invalidateQueries({queryKey:["jobs"]})}),i=(0,y.n)({mutationFn:e=>v.rejectJob(e),onSuccess:()=>s.invalidateQueries({queryKey:["jobs"]})}),j=(0,y.n)({mutationFn:e=>v.runJob(e),onSuccess:()=>s.invalidateQueries({queryKey:["jobs"]})}),w=(0,y.n)({mutationFn:e=>v.rerunJob(e),onSuccess:()=>{s.invalidateQueries({queryKey:["jobs"]}),T.oR.success("Job restarted successfully")},onError:e=>{T.oR.error("Failed to rerun job: ".concat(e.message))}}),k=(0,y.n)({mutationFn:e=>v.deleteJob(e),onSuccess:()=>s.invalidateQueries({queryKey:["jobs"]})}),{isPending:A,data:F}=e;return A?(0,t.jsx)(el,{}):(0,t.jsx)(t.Fragment,{children:(null==F?void 0:F.jobs.length)===0?(0,t.jsx)("div",{className:"py-12 text-center",children:(0,t.jsxs)("div",{className:"mx-auto max-w-md",children:[(0,t.jsx)("div",{className:"text-muted-foreground mx-auto mb-4 h-12 w-12",children:(0,t.jsx)(o.A,{className:"h-12 w-12"})}),(0,t.jsx)("h3",{className:"text-foreground mb-2 text-lg font-medium",children:"No jobs found"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-6",children:"Jobs will appear here when researchers request access to your datasets"})]})}):(0,t.jsx)("div",{className:"flex gap-4 overflow-x-auto pb-4",children:["pending","approved","rejected","running","finished","failed"].map(e=>{var s;let o,b=(o=null!=(s=null==F?void 0:F.jobs)?s:[],o.filter(s=>s.status===e));return(0,t.jsxs)("div",{className:"flex flex-col flex-shrink-0 w-56",children:[(0,t.jsx)("div",{className:"border-t-4 rounded-t-lg ".concat({pending:"border-yellow-200 dark:border-yellow-900",approved:"border-emerald-200 dark:border-emerald-900",rejected:"border-red-200 dark:border-red-900",running:"border-blue-200 dark:border-blue-900",finished:"border-green-200 dark:border-green-900",failed:"border-orange-200 dark:border-orange-900"}[e]," bg-card p-2"),children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-xs font-semibold capitalize",children:e}),(0,t.jsx)(d.E,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:b.length})]})}),(0,t.jsx)("div",{className:"flex-1 space-y-2 mt-2 min-h-[200px] max-h-[calc(100vh-400px)] overflow-y-auto pr-2",children:0===b.length?(0,t.jsx)("div",{className:"text-center text-muted-foreground text-xs py-8",children:"No jobs"}):b.map(e=>(0,t.jsxs)(l.Zp,{className:"hover:shadow-lg hover:bg-gray-100 hover:border-gray-700 transition-all border-black dark:border-gray-700 dark:hover:bg-gray-800/50",children:[(0,t.jsxs)(l.aR,{className:"pb-1 px-2 pt-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,t.jsx)(l.ZB,{className:"text-xs truncate font-semibold flex-1",children:e.projectName}),(0,t.jsx)(V,{job:e,children:(0,t.jsx)(a.$,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 hover:bg-muted",title:"Show Details",children:(0,t.jsx)(c,{className:"h-3 w-3"})})})]}),(0,t.jsx)(l.BT,{className:"text-[10px] line-clamp-1 mt-0.5",children:e.description})]}),(0,t.jsxs)(l.Wu,{className:"space-y-1.5 px-2 pb-2",children:[(0,t.jsxs)("p",{className:"text-muted-foreground text-[10px]",children:[(0,g.fF)(e.requestedTime.toISOString())," by"," ",(0,t.jsx)("span",{className:"text-foreground/70 font-medium",children:e.requesterEmail})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:["pending"===e.status&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(a.$,{variant:"outline",size:"sm",onClick:()=>r.mutate(e.uid),className:"border-emerald-500 text-emerald-600 hover:bg-emerald-50 hover:text-emerald-700 dark:border-emerald-700 dark:text-emerald-400 dark:hover:bg-emerald-900/30 w-full h-7 text-xs",children:[(0,t.jsx)(x.A,{className:"mr-1 h-3 w-3"}),"Approve"]}),(0,t.jsxs)(a.$,{variant:"outline",size:"sm",onClick:()=>i.mutate(e.uid),className:"border-red-500 text-red-600 hover:bg-red-50 hover:text-red-700 dark:border-red-700 dark:text-red-400 dark:hover:bg-red-900/30 w-full h-7 text-xs",children:[(0,t.jsx)(h.A,{className:"mr-1 h-3 w-3"}),"Reject"]})]}),"approved"===e.status&&(0,t.jsxs)(a.$,{variant:"outline",size:"sm",onClick:()=>j.mutate(e.uid),disabled:j.isPending,className:"border-blue-500 text-blue-600 hover:bg-blue-50 hover:text-blue-700 dark:border-blue-700 dark:text-blue-400 dark:hover:bg-blue-900/30 w-full h-7 text-xs",children:[(0,t.jsx)(u,{className:"mr-1 h-3 w-3"}),j.isPending?"Starting...":"Run"]}),("running"===e.status||"finished"===e.status||"failed"===e.status)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(z,{job:e}),(0,t.jsx)(Y,{job:e})]}),("finished"===e.status||"failed"===e.status)&&(0,t.jsxs)(a.$,{variant:"outline",size:"sm",onClick:()=>w.mutate(e.uid),disabled:w.isPending,className:"border-blue-500 text-blue-600 hover:bg-blue-50 hover:text-blue-700 dark:border-blue-700 dark:text-blue-400 dark:hover:bg-blue-900/30 w-full h-7 text-xs",children:[(0,t.jsx)(m,{className:"mr-1 h-3 w-3"}),w.isPending?"Starting...":"Rerun"]}),(0,t.jsx)(Q,{job:e}),(0,t.jsxs)(a.$,{variant:"outline",size:"sm",onClick:()=>k.mutate(e.uid),disabled:k.isPending,className:"border-2 border-orange-600 text-orange-700 hover:bg-orange-50 hover:text-orange-800 hover:border-orange-700 dark:border-orange-700 dark:text-orange-400 dark:hover:bg-orange-900/30 w-full h-7 text-xs font-medium",children:[(0,t.jsx)(n.A,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]},e.uid))})]},e)})})})}function el(){return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(w.E,{className:"h-7 w-64"}),[void 0,void 0,void 0].map((e,s)=>(0,t.jsx)(l.Zp,{children:(0,t.jsxs)(l.Wu,{className:"flex h-40 flex-col justify-between p-6",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(w.E,{className:"mb-1 h-8 w-80"}),(0,t.jsx)(w.E,{className:"h-5 w-64"})]}),(0,t.jsx)(w.E,{className:"h-[22px] w-16"})]}),(0,t.jsxs)("div",{className:"flex items-end justify-between",children:[(0,t.jsx)(w.E,{className:"h-5 w-96"}),(0,t.jsx)(w.E,{className:"h-9 w-32"})]})]})},s))]})}function ed(){return(0,t.jsx)(er,{})}}},e=>{e.O(0,[529,288,696,441,964,358],()=>e(e.s=79050)),_N_E=e.O()}]);