(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[531],{5199:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>B});var t=a(5155),r=a(7168),l=a(8482),d=a(8145),i=a(7576),n=a(9946);let c=(0,n.A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var o=a(4416);let m=(0,n.A)("code-xml",[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]]);var u=a(7497),x=a(3999),h=a(2235);let p={openJobCode:e=>{let{jobUid:s}=e;return h.u.get("/api/v1/jobs/open-code/".concat(s))},approveJob:e=>h.u.post("/api/v1/jobs/approve/".concat(e),{}),rejectJob:e=>h.u.post("/api/v1/jobs/reject/".concat(e),{})};var j=a(2960),v=a(70),b=a(9852);let y={getTrustedDatasites:async()=>h.u.get("/api/v1/trusted-datasites"),setTrustedDatasites:async e=>h.u.post("/api/v1/trusted-datasites",{datasites:e})};var g=a(221),f=a(6715),N=a(5041),k=a(1154);let w=(0,n.A)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var A=a(4616),q=a(2177),E=a(1442);function z(){let e=(0,f.jE)(),{isPending:s,data:a}=(0,j.I)({queryKey:["autoApproved"],queryFn:async()=>y.getTrustedDatasites()}),i=(0,q.mN)({resolver:(0,g.u)(M),defaultValues:{email:""}}),n=(0,N.n)({mutationFn:async e=>{let{autoApprovedEmails:s,email:a}=e;if(!a||s.includes(a))return;let t=[...s,a];return y.setTrustedDatasites(t)},onSettled:async()=>{await e.invalidateQueries({queryKey:["autoApproved"]}),i.reset()}}),c=(0,N.n)({mutationFn:async e=>{let{autoApprovedEmails:s,email:a}=e;if(!a)return;let t=s.filter(e=>e!==a);return y.setTrustedDatasites(t)},onSettled:()=>e.invalidateQueries({queryKey:["autoApproved"]})}),m=n.isPending||c.isPending;return(0,t.jsxs)(l.Zp,{className:"relative",children:[s?(0,t.jsx)(k.A,{size:64,className:"absolute inset-0 z-10 m-auto animate-spin"}):null,(0,t.jsxs)(l.aR,{className:(0,x.cn)(m||s?"pointer-events-none opacity-50":"opacity-100","relative transition-opacity duration-100"),children:[(0,t.jsxs)(l.ZB,{className:"flex items-center",children:[(0,t.jsx)(w,{className:"mr-2 h-5 w-5"}),"Auto-approval Settings"]}),(0,t.jsx)(l.BT,{children:"Automatically approve requests from trusted datasites"})]}),(0,t.jsxs)(l.Wu,{className:(0,x.cn)(m||s?"pointer-events-none opacity-50":"opacity-100","relative transition-opacity duration-100"),children:[(0,t.jsx)(v.lV,{...i,children:(0,t.jsxs)("form",{onSubmit:i.handleSubmit(function(e){var s;n.mutate({autoApprovedEmails:null!=(s=null==a?void 0:a.datasites)?s:[],email:e.email})}),className:"flex items-end gap-2",children:[(0,t.jsx)(v.zB,{control:i.control,name:"email",render:e=>{let{field:a}=e;return(0,t.jsxs)(v.eI,{className:"w-full",children:[(0,t.jsx)(v.lR,{children:"Add a trusted datasite email"}),(0,t.jsx)(v.MJ,{children:(0,t.jsx)(b.p,{placeholder:"trusted@email.com",type:"email",autoComplete:"off",disabled:s,className:"w-full",...a})})]})}}),(0,t.jsx)(r.$,{disabled:s,size:"icon",className:"shrink-0",children:n.isPending?(0,t.jsx)(k.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(A.A,{className:"size-5"})})]})}),(0,t.jsx)("div",{className:"mt-4 flex flex-wrap gap-2",children:null==a?void 0:a.datasites.map(e=>(0,t.jsxs)(d.E,{variant:"secondary",className:"flex items-center gap-1",children:[e,(0,t.jsx)("button",{onClick:()=>c.mutate({email:e,autoApprovedEmails:a.datasites}),className:"hover:text-destructive ml-1",disabled:s,children:(0,t.jsx)(o.A,{className:"h-3 w-3"})})]},e))})]})]})}let M=E.Ay$.object({email:E.Ay$.email("Not a valid email address")});var C=a(7737),J=a(7777);let T=(0,n.A)("circle-dashed",[["path",{d:"M10.1 2.182a10 10 0 0 1 3.8 0",key:"5ilxe3"}],["path",{d:"M13.9 21.818a10 10 0 0 1-3.8 0",key:"11zvb9"}],["path",{d:"M17.609 3.721a10 10 0 0 1 2.69 2.7",key:"1iw5b2"}],["path",{d:"M2.182 13.9a10 10 0 0 1 0-3.8",key:"c0bmvh"}],["path",{d:"M20.279 17.609a10 10 0 0 1-2.7 2.69",key:"1ruxm7"}],["path",{d:"M21.818 10.1a10 10 0 0 1 0 3.8",key:"qkgqxc"}],["path",{d:"M3.721 6.391a10 10 0 0 1 2.7-2.69",key:"1mcia2"}],["path",{d:"M6.391 20.279a10 10 0 0 1-2.69-2.7",key:"1fvljs"}]]),S=(0,n.A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),F=(0,n.A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);function K(e){let{jobStatus:s}=e,a={pending:T,approved:S,denied:F}[s];return(0,t.jsxs)(J.m_,{children:[(0,t.jsx)(J.k$,{asChild:!0,children:(0,t.jsxs)(d.E,{className:(0,x.cn)({pending:"border-yellow-300 bg-yellow-50 text-yellow-600 dark:border-yellow-900 dark:bg-yellow-900/30 dark:text-yellow-400 hover:bg-yellow-100 hover:border-yellow-400 hover:text-yellow-700 dark:hover:bg-yellow-900/30",approved:"border-emerald-300 bg-emerald-50 text-emerald-600 dark:border-emerald-900 dark:bg-emerald-900/30 dark:text-emerald-400 hover:bg-emerald-100 hover:border-emerald-400 hover:text-emerald-700 dark:hover:bg-emerald-900/30",denied:"border-red-200 bg-red-50 text-red-600 dark:border-red-900 dark:bg-red-900/30 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30"}[s],"cursor-default gap-2 transition"),children:[(0,t.jsx)(a,{}),s]})}),(0,t.jsx)(J.ZI,{children:{pending:"This job is pending execution",approved:"This job has been approved and executed",denied:"This job has been denied"}[s]})]})}function $(){return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Jobs"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Manage data access requests and research projects"})]}),(0,t.jsx)(z,{}),(0,t.jsx)(_,{})]})}function _(){let e=(0,j.I)({queryKey:["jobs"],queryFn:async()=>await u.K.getJobs()}),s=(0,f.jE)(),a=(0,N.n)({mutationFn:e=>p.approveJob(e),onSuccess:()=>s.invalidateQueries({queryKey:["jobs"]})}),n=(0,N.n)({mutationFn:e=>p.rejectJob(e),onSuccess:()=>s.invalidateQueries({queryKey:["jobs"]})}),{isPending:m,data:h}=e;return m?(0,t.jsx)(D,{}):(0,t.jsx)(t.Fragment,{children:(null==h?void 0:h.jobs.length)===0?(0,t.jsx)("div",{className:"py-12 text-center",children:(0,t.jsxs)("div",{className:"mx-auto max-w-md",children:[(0,t.jsx)("div",{className:"text-muted-foreground mx-auto mb-4 h-12 w-12",children:(0,t.jsx)(i.A,{className:"h-12 w-12"})}),(0,t.jsx)("h3",{className:"text-foreground mb-2 text-lg font-medium",children:"No jobs found"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-6",children:"Jobs will appear here when researchers request access to your datasets"})]})}):["pending","approved","denied"].map(e=>{var s;let i,m=(i=null!=(s=null==h?void 0:h.jobs)?s:[],i.filter(s=>s.status===e));return 0===m.length?null:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)("h2",{className:"text-xl font-semibold capitalize",children:[e," Jobs"]}),(0,t.jsx)(d.E,{variant:"outline",children:m.length})]}),(0,t.jsx)("div",{className:"grid gap-4",children:m.map(e=>(0,t.jsxs)(l.Zp,{children:[(0,t.jsx)(l.aR,{children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(l.ZB,{className:"flex items-center gap-4 text-lg",children:e.projectName}),(0,t.jsx)(l.BT,{children:e.description})]}),(0,t.jsx)(K,{jobStatus:e.status})]})}),(0,t.jsx)(l.Wu,{children:(0,t.jsxs)("div",{className:"flex items-end justify-between",children:[(0,t.jsxs)("p",{className:"text-muted-foreground text-sm",children:["Requested ",(0,x.fF)(e.requestedTime.toISOString())," ","by"," ",(0,t.jsx)("strong",{className:"text-foreground/70 font-semibold tracking-wide",children:e.requesterEmail})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:["pending"===e.status&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(r.$,{variant:"outline",size:"sm",onClick:()=>a.mutate(e.uid),className:"border-emerald-500 text-emerald-600 hover:bg-emerald-50 hover:text-emerald-700 dark:border-emerald-700 dark:text-emerald-400 dark:hover:bg-emerald-900/30",children:[(0,t.jsx)(c,{className:"mr-2 h-4 w-4"}),"Approve"]}),(0,t.jsxs)(r.$,{variant:"outline",size:"sm",onClick:()=>n.mutate(e.uid),className:"border-red-500 text-red-600 hover:bg-red-50 hover:text-red-700 dark:border-red-700 dark:text-red-400 dark:hover:bg-red-900/30",children:[(0,t.jsx)(o.A,{className:"mr-2 h-4 w-4"}),"Deny"]})]}),(0,t.jsx)(Z,{job:e})]})]})})]},e.uid))})]},e)})})}function D(){return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(C.E,{className:"h-7 w-64"}),[void 0,void 0,void 0].map((e,s)=>(0,t.jsx)(l.Zp,{children:(0,t.jsxs)(l.Wu,{className:"flex h-40 flex-col justify-between p-6",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(C.E,{className:"mb-1 h-8 w-80"}),(0,t.jsx)(C.E,{className:"h-5 w-64"})]}),(0,t.jsx)(C.E,{className:"h-[22px] w-16"})]}),(0,t.jsxs)("div",{className:"flex items-end justify-between",children:[(0,t.jsx)(C.E,{className:"h-5 w-96"}),(0,t.jsx)(C.E,{className:"h-9 w-32"})]})]})},s))]})}function Z(e){let{job:s}=e;return(0,t.jsxs)(r.$,{variant:"outline",size:"sm",onClick:()=>p.openJobCode({jobUid:s.uid}),children:[(0,t.jsx)(m,{}),"View Code"]})}function B(){return(0,t.jsx)($,{})}},7576:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(9946).A)("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]])},9437:(e,s,a)=>{Promise.resolve().then(a.bind(a,5199))}},e=>{e.O(0,[574,530,913,441,964,358],()=>e(e.s=9437)),_N_E=e.O()}]);