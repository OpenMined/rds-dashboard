(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[214],{4331:(e,t,s)=>{"use strict";s.d(t,{J:()=>i,X:()=>l});var a=s(5155),n=s(2115);let r=(0,n.createContext)(null);function i(){let e=(0,n.useContext)(r);if(!e)throw Error("useDragDrop must be used within a DragDropProvider");return e}function l(e){let{children:t}=e,[s,i]=(0,n.useState)(!1),[l,d]=(0,n.useState)(null),o=(0,n.useCallback)((e,t)=>{e.preventDefault(),e.stopPropagation(),i(!0),d(t)},[]),c=(0,n.useCallback)((e,t)=>{e.preventDefault(),e.stopPropagation(),l===t&&(i(!1),d(null))},[l]),u=(0,n.useCallback)((e,t)=>{e.preventDefault(),e.stopPropagation(),i(!0),d(t)},[]),m=(0,n.useCallback)((e,t,s)=>{e.preventDefault(),e.stopPropagation(),i(!1),d(null);let a=e.dataTransfer.files;a&&a.length>0&&s(a[0])},[]);return(0,a.jsx)(r.Provider,{value:{isDragging:s,activeDropZone:l,setActiveDropZone:d,handleDragEnter:o,handleDragLeave:c,handleDragOver:u,handleDrop:m},children:t})}},6853:(e,t,s)=>{Promise.resolve().then(s.bind(s,9511))},9511:(e,t,s)=>{"use strict";s.d(t,{DatasetsView:()=>eK});var a=s(5155),n=s(7777),r=s(3999);function i(e){let{data:t,className:s,chartHeightPx:i=96}=e,l=Math.max(...t);return(0,a.jsx)("div",{className:(0,r.cn)("flex w-64 items-end",s),style:{height:i},children:t.map((e,t)=>{var s,d,o;let{start:c,end:u}=(e=>{let t=new Date,s=new Date(t);s.setDate(t.getDate()-7*(11-e));let a=new Date(s);return a.setDate(s.getDate()-6),{start:a.toLocaleDateString(void 0,{month:"short",day:"numeric"}),end:s.toLocaleDateString(void 0,{month:"short",day:"numeric"})}})(t);return(0,a.jsxs)(n.m_,{delayDuration:0,children:[(0,a.jsx)(n.k$,{asChild:!0,children:(0,a.jsx)("div",{className:(0,r.cn)("flex flex-1 items-end px-0.5 brightness-100 transition hover:brightness-75 dark:hover:brightness-150"),style:{height:i},children:(0,a.jsx)("div",{className:"h-full w-full rounded-sm ".concat((e=>{switch(e){case 0:default:return"bg-muted";case 1:return"bg-green-200 dark:bg-green-900";case 2:return"bg-green-300 dark:bg-green-700";case 3:return"bg-green-400 dark:bg-green-600";case 4:return"bg-green-500 dark:bg-green-500"}})(0===e?0:e<=.25*l?1:e<=.5*l?2:e<=.75*l?3:4)),style:{height:(s=e,d=l,o=i,0===d?4:Math.max(4,s/d*o))}})})}),(0,a.jsx)(n.ZI,{children:(0,a.jsxs)("div",{className:"text-xs",children:[(0,a.jsxs)("div",{className:"font-medium",children:[e," requests"]}),(0,a.jsxs)("div",{className:"text-muted-foreground",children:[c," - ",u]})]})})]},t)})})}var l=s(2115);let d=(0,s(2085).F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:s,...n}=e;return(0,a.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,r.cn)(d({variant:s}),t),...n})}function c(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"alert-description",className:(0,r.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...s})}var u=s(7649),m=s(7168);function x(e){let{...t}=e;return(0,a.jsx)(u.bL,{"data-slot":"alert-dialog",...t})}function h(e){let{...t}=e;return(0,a.jsx)(u.ZL,{"data-slot":"alert-dialog-portal",...t})}function p(e){let{className:t,...s}=e;return(0,a.jsx)(u.hJ,{"data-slot":"alert-dialog-overlay",className:(0,r.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function f(e){let{className:t,...s}=e;return(0,a.jsxs)(h,{children:[(0,a.jsx)(p,{}),(0,a.jsx)(u.UC,{"data-slot":"alert-dialog-content",className:(0,r.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...s})]})}function j(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"alert-dialog-header",className:(0,r.cn)("flex flex-col gap-2 text-center sm:text-left",t),...s})}function g(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"alert-dialog-footer",className:(0,r.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...s})}function v(e){let{className:t,...s}=e;return(0,a.jsx)(u.hE,{"data-slot":"alert-dialog-title",className:(0,r.cn)("text-lg font-semibold",t),...s})}function b(e){let{className:t,...s}=e;return(0,a.jsx)(u.VY,{"data-slot":"alert-dialog-description",className:(0,r.cn)("text-muted-foreground text-sm",t),...s})}function N(e){let{className:t,...s}=e;return(0,a.jsx)(u.rc,{className:(0,r.cn)((0,m.r)(),t),...s})}function y(e){let{className:t,...s}=e;return(0,a.jsx)(u.ZD,{className:(0,r.cn)((0,m.r)({variant:"outline"}),t),...s})}var w=s(8482),D=s(7489);function k(e){let{className:t,orientation:s="horizontal",decorative:n=!0,...i}=e;return(0,a.jsx)(D.b,{"data-slot":"separator",decorative:n,orientation:s,className:(0,r.cn)("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",t),...i})}var C=s(5452),S=s(4416);function A(e){let{...t}=e;return(0,a.jsx)(C.bL,{"data-slot":"sheet",...t})}function z(e){let{...t}=e;return(0,a.jsx)(C.ZL,{"data-slot":"sheet-portal",...t})}function E(e){let{className:t,...s}=e;return(0,a.jsx)(C.hJ,{"data-slot":"sheet-overlay",className:(0,r.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function $(e){let{className:t,children:s,side:n="right",...i}=e;return(0,a.jsxs)(z,{children:[(0,a.jsx)(E,{}),(0,a.jsxs)(C.UC,{"data-slot":"sheet-content",className:(0,r.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-300","right"===n&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm","left"===n&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm","top"===n&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b","bottom"===n&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",t),...i,children:[s,(0,a.jsxs)(C.bm,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[(0,a.jsx)(S.A,{className:"size-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function L(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"sheet-header",className:(0,r.cn)("flex flex-col gap-1.5 p-4",t),...s})}function F(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"sheet-footer",className:(0,r.cn)("mt-auto flex flex-col gap-2 p-4",t),...s})}function R(e){let{className:t,...s}=e;return(0,a.jsx)(C.hE,{"data-slot":"sheet-title",className:(0,r.cn)("text-foreground font-semibold",t),...s})}function _(e){let{className:t,...s}=e;return(0,a.jsx)(C.VY,{"data-slot":"sheet-description",className:(0,r.cn)("text-muted-foreground text-sm",t),...s})}var q=s(7497),I=s(6715),U=s(5041),M=s(1788),Z=s(8898),O=s(2525),J=s(1243);function P(e){let{...t}=e;return(0,a.jsx)(C.bL,{"data-slot":"dialog",...t})}function T(e){let{...t}=e;return(0,a.jsx)(C.l9,{"data-slot":"dialog-trigger",...t})}function K(e){let{...t}=e;return(0,a.jsx)(C.ZL,{"data-slot":"dialog-portal",...t})}function V(e){let{...t}=e;return(0,a.jsx)(C.bm,{"data-slot":"dialog-close",...t})}function B(e){let{className:t,...s}=e;return(0,a.jsx)(C.hJ,{"data-slot":"dialog-overlay",className:(0,r.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed -inset-1 z-50 bg-black/50","debug",t),...s})}function W(e){let{className:t,children:s,showCloseButton:n=!0,...i}=e;return(0,a.jsxs)(K,{"data-slot":"dialog-portal",children:[(0,a.jsx)(B,{}),(0,a.jsxs)(C.UC,{"data-slot":"dialog-content",className:(0,r.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...i,children:[s,n&&(0,a.jsxs)(C.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus-visible:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:outline-hidden focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,a.jsx)(S.A,{}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function Q(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"dialog-header",className:(0,r.cn)("flex flex-col gap-2 text-center sm:text-left",t),...s})}function Y(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"dialog-footer",className:(0,r.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...s})}function H(e){let{className:t,...s}=e;return(0,a.jsx)(C.hE,{"data-slot":"dialog-title",className:(0,r.cn)("text-lg leading-none font-semibold",t),...s})}function G(e){let{className:t,...s}=e;return(0,a.jsx)(C.VY,{"data-slot":"dialog-description",className:(0,r.cn)("text-muted-foreground text-sm",t),...s})}var X=s(70),ee=s(9852);function et(e){let{className:t,...s}=e;return(0,a.jsx)("textarea",{"data-slot":"textarea",className:(0,r.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...s})}var es=s(1442),ea=s(2235);let en=es.Ay$.object({name:es.Ay$.string().min(1,{message:"A dataset name is required"}),url:es.Ay$.string().pipe(es.Ay$.preprocess(e=>""===e||e.startsWith("https://")||e.startsWith("http://")?e:"https://"+e,es.Ay$.url({protocol:/^(https?)?$/,hostname:es.Ay$.regexes.domain,error:e=>""===e.input?"The store URL is required":void 0}))),pat:es.Ay$.string().min(1,{message:"The access token is required"}).regex(/^shpat_[0-9a-f]{32}$/,{error:()=>"Invalid access token format"}),description:es.Ay$.string().optional()}),er=es.Ay$.object({name:es.Ay$.string().optional(),description:es.Ay$.string().optional()}),ei={async getDatasets(){let e=await ea.u.get("/api/v1/datasets"),t=await q.K.getJobs(),s=t.jobs.reduce((e,t)=>{let s=e.get(t.datasetName)||[];return e.set(t.datasetName,[...s,t]),e},new Map),a=t.jobs.reduce((e,t)=>{let s=e.get(t.datasetName)||new Set;return s.add(t.requesterEmail),e.set(t.datasetName,s),e},new Map),n=t.jobs.reduce((e,t)=>{var s;let a=(s=t.requestedTime,Math.floor((new Date().getTime()-s.getTime())/6048e5));if(a>=0&&a<12){let s=e.get(t.datasetName)||Array(12).fill(0);s[11-a]++,e.set(t.datasetName,s)}return e},new Map);return{datasets:e.datasets.map(e=>{var t,i;return{uid:e.uid,name:e.name,description:e.summary,size:(0,r.z3)(e.privateSize),type:e.private.split(".").pop()||"unknown",createdAt:new Date(e.createdAt),lastUpdated:new Date(e.updatedAt),accessRequests:0,permissions:[],usersCount:(null==(t=a.get(e.name))?void 0:t.size)||0,requestsCount:(null==(i=s.get(e.name))?void 0:i.length)||0,activityData:n.get(e.name)||Array(12).fill(0),source:e.source}})}},addShopifyDataset:e=>ea.u.post("/api/v1/datasets/import-from-shopify",e),updateShopifyDataset:e=>{let{uid:t,data:s}=e;return ea.u.put("/api/v1/datasets/update/".concat(t),s)},syncShopifyDataset:e=>ea.u.put("/api/v1/datasets/sync-shopify-dataset/".concat(e),{}),openLocalDirectory:e=>ea.u.get("/api/v1/datasets/open-local-directory/".concat(e))};var el=s(7328),ed=s(221),eo=s(3717),ec=s(1154),eu=s(4229),em=s(2177),ex=s(6671);function eh(e){let{dataset:t}=e,s=(0,I.jE)(),n=(0,em.mN)({resolver:(0,ed.u)(er),defaultValues:{name:t.name,description:t.description}}),{setError:r}=n,i=(0,U.n)({mutationFn:ei.updateShopifyDataset,onSuccess:()=>((0,ex.oR)("Updated dataset"),s.invalidateQueries({queryKey:["datasets"]})),onError:e=>{e instanceof el.ZM&&r(e.loc,{message:e.message}),e instanceof el.hD&&(0,ex.oR)("Error",{description:e.message})}}),{isPending:l}=i;return(0,a.jsxs)(P,{children:[(0,a.jsx)(T,{asChild:!0,children:(0,a.jsxs)(m.$,{variant:"outline",className:"w-full justify-start",children:[(0,a.jsx)(eo.A,{className:"h-4 w-4"}),"Update Dataset"]})}),(0,a.jsxs)(W,{children:[(0,a.jsx)(Q,{children:(0,a.jsx)(H,{children:"Update Dataset"})}),(0,a.jsx)(X.lV,{...n,children:(0,a.jsxs)("form",{onSubmit:n.handleSubmit(function(e){let s={...e,name:e.name!==t.name?e.name:void 0,description:e.description!==t.description?e.description:void 0};i.mutate({uid:t.uid,data:s})}),className:"flex flex-col gap-5",children:[(0,a.jsx)(X.zB,{name:"name",render:e=>{let{field:s}=e;return(0,a.jsxs)(X.eI,{children:[(0,a.jsxs)("div",{className:"relative w-full",children:[(0,a.jsx)(X.lR,{children:"Dataset Name"}),(0,a.jsx)(X.C5,{className:"absolute top-1 right-0"})]}),(0,a.jsx)(X.MJ,{children:(0,a.jsx)(ee.p,{placeholder:t.name,...s})})]})}}),(0,a.jsx)(X.zB,{name:"description",render:e=>{let{field:s}=e;return(0,a.jsxs)(X.eI,{children:[(0,a.jsxs)("div",{className:"relative w-full",children:[(0,a.jsx)(X.lR,{children:"Description"}),(0,a.jsx)(X.C5,{className:"absolute top-1 right-0"})]}),(0,a.jsx)(X.MJ,{children:(0,a.jsx)(et,{placeholder:t.name,...s})})]})}}),(0,a.jsxs)(Y,{children:[(0,a.jsx)(V,{asChild:!0,children:(0,a.jsx)(m.$,{type:"button",variant:"outline",onClick:()=>{n.reset()},disabled:l,children:"Cancel"})}),(0,a.jsx)(m.$,{type:"submit",disabled:l,children:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ec.A,{className:"h-4 w-4 animate-spin"}),"Saving..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eu.A,{className:"h-4 w-4"}),"Save Change"]})})]})]})})]})]})}function ep(e){let{dataset:t,open:s,onOpenChange:n}=e,[r,d]=(0,l.useState)(!1),[u,h]=(0,l.useState)(""),[p,D]=(0,l.useState)(!1),C=(0,I.jE)(),S=(0,U.n)({mutationFn:e=>{let{datasetName:t}=e;return q.K.deleteDataset(t)},onError:e=>{console.error(e)},onSuccess:()=>{C.invalidateQueries({queryKey:["datasets"]}),n(!1),ex.oR.success("Success",{description:"Removed dataset"})}}),z=async()=>{if(t){d(!0),h("");try{let e=await q.K.downloadDatasetPrivate(t.uid),s=await e.blob(),a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a;let i=e.headers.get("Content-Disposition"),l=null==i?void 0:i.match(/filename="(.+)"/);r.download=l?l[1]:"".concat(t.name,".csv"),document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(a),document.body.removeChild(r),ex.oR.success("Dataset downloaded successfully"),n(!1)}catch(e){h(e instanceof Error?e.message:"Failed to download dataset")}finally{d(!1)}}};return t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(A,{open:s,onOpenChange:n,children:(0,a.jsxs)($,{className:"scrollbar-thin overflow-y-auto",children:[(0,a.jsxs)(L,{children:[(0,a.jsx)(R,{className:"text-2xl",children:t.name}),(0,a.jsx)(_,{children:t.description})]}),(0,a.jsxs)("div",{className:"flex-1",children:[u&&(0,a.jsx)(o,{variant:"destructive",className:"mb-4",children:(0,a.jsx)(c,{className:"break-all",children:u})}),(0,a.jsxs)("div",{className:"flex flex-col gap-4 px-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"text-muted-foreground",children:"Format"}),(0,a.jsx)("div",{className:"font-medium",children:t.type.toUpperCase()})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"text-muted-foreground",children:"Size"}),(0,a.jsx)("div",{className:"font-medium",children:t.size})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"text-muted-foreground",children:"Created"}),(0,a.jsx)("div",{className:"font-medium",children:new Date(t.createdAt).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"text-muted-foreground",children:"Last Updated"}),(0,a.jsx)("div",{className:"font-medium",children:new Date(t.lastUpdated).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})})]})]}),(0,a.jsxs)(w.Zp,{children:[(0,a.jsx)(w.aR,{className:"pb-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(w.ZB,{className:"text-sm font-medium",children:"Activity Overview"}),(0,a.jsx)("div",{className:"text-muted-foreground text-xs",children:"Last 12 weeks"})]})}),(0,a.jsxs)(w.Wu,{children:[(0,a.jsx)(i,{data:t.activityData,className:"w-full",chartHeightPx:128}),(0,a.jsxs)("div",{className:"text-muted-foreground mt-4 flex items-center justify-between text-xs",children:[(0,a.jsx)("div",{children:"Total Requests: 1"}),(0,a.jsx)("div",{children:"Avg: 0/week"})]})]})]})]})]}),(0,a.jsxs)(F,{children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-sm font-medium",children:"Actions"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(m.$,{variant:"outline",className:"w-full justify-start",onClick:z,disabled:r,children:[(0,a.jsx)(M.A,{className:"h-4 w-4"}),"Download Dataset"]}),(0,a.jsxs)(m.$,{variant:"outline",className:"w-full justify-start",onClick:()=>ei.openLocalDirectory(t.uid),children:[(0,a.jsx)(Z.A,{}),"View Dataset"]}),(0,a.jsx)(eh,{dataset:t}),(0,a.jsxs)(m.$,{variant:"outline",className:"w-full justify-start text-red-600 hover:bg-red-50 hover:text-red-700",onClick:()=>D(!0),disabled:r,children:[(0,a.jsx)(O.A,{className:"h-4 w-4"}),"Delete Dataset"]})]})]}),(0,a.jsx)(k,{className:"my-2"}),(0,a.jsx)(m.$,{variant:"outline",onClick:()=>n(!1),className:"w-full",children:"Close"})]})]})}),(0,a.jsx)(x,{open:p,onOpenChange:D,children:(0,a.jsxs)(f,{children:[(0,a.jsxs)(j,{children:[(0,a.jsxs)(v,{className:"flex items-center gap-2",children:[(0,a.jsx)(J.A,{className:"h-5 w-5 text-red-500"}),"Delete Dataset"]}),(0,a.jsxs)(b,{children:["Are you sure you want to delete"," ",(0,a.jsx)("span",{className:"font-semibold",children:t.name}),"? This action cannot be undone."]})]}),(0,a.jsxs)(g,{children:[(0,a.jsx)(y,{children:"Cancel"}),(0,a.jsx)(N,{onClick:()=>t&&S.mutate({datasetName:t.name}),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})]}):null}var ef=s(7737),ej=s(2960),eg=s(4213),ev=s(8145),eb=s(5112),eN=s(7580),ey=s(2713),ew=s(9074),eD=s(5880),ek=s(4315);function eC(e){let{children:t,className:s,...n}=e;return(0,a.jsx)("div",{...n,className:(0,r.cn)("flex cursor-default items-center gap-1.5 space-x-1 whitespace-nowrap rounded-sm bg-transparent px-2 py-0.5 text-sm text-muted-foreground transition-colors hover:bg-muted hover:text-foreground [&>svg]:pointer-events-none [&>svg]:mb-px [&>svg]:size-4",s),children:t})}var eS=s(3904);function eA(e){let{dataset:t}=e,s=(0,I.jE)(),n=(0,l.useRef)(null),r=(0,U.n)({mutationFn:ei.syncShopifyDataset,onSuccess:()=>{ex.oR.success("Dataset synced successfully")},onSettled:()=>(n.current&&(n.current.style.animationIterationCount="1"),s.invalidateQueries({queryKey:["datasets"]}))}),{isPending:i}=r;return(0,a.jsxs)(m.$,{size:"sm",variant:"outline",onClick:()=>{(()=>{let e=n.current;if(!e)return;e.classList.remove("animate-spin"),e.offsetHeight,e.style.animationIterationCount="infinite",e.classList.add("animate-spin");let t=()=>{e.classList.remove("animate-spin"),e.removeEventListener("animationend",t)};e.addEventListener("animationend",t)})(),r.mutate(t.uid)},disabled:i,children:[(0,a.jsx)("span",{ref:n,className:"inline-flex duration-500",children:(0,a.jsx)(eS.A,{})}),"Sync"]})}function ez(e){var t,s;let{dataset:l,onSelect:d}=e;return(0,a.jsx)(w.Zp,{children:(0,a.jsxs)(w.Wu,{className:"flex justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-1 flex-col justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-1 flex items-center gap-3",children:[(0,a.jsx)("h3",{className:"cursor-pointer text-xl font-semibold text-blue-600 hover:underline",onClick:d,children:l.name}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsxs)(n.m_,{children:[(0,a.jsx)(n.k$,{asChild:!0,children:(0,a.jsxs)(ev.E,{variant:"secondary",className:"cursor-default gap-2 bg-green-100 text-green-800 transition-colors hover:bg-green-200 hover:text-green-900 dark:bg-green-900 dark:text-green-300 dark:hover:bg-green-800 dark:hover:text-green-100",children:[(0,a.jsx)(eb.A,{size:12})," ",l.type.toUpperCase()]})}),(0,a.jsxs)(n.ZI,{children:["Dataset format: ",l.type.toUpperCase()]})]}),(null==(t=l.source)?void 0:t.type)==="shopify"?(0,a.jsxs)(n.m_,{children:[(0,a.jsx)(n.k$,{asChild:!0,children:(0,a.jsxs)(ev.E,{variant:"outline",className:"hover:bg-muted dark:hover:bg-muted cursor-default gap-2 transition-colors",children:[(0,a.jsx)(ek.M2,{size:14})," Shopify"]})}),(0,a.jsx)(n.ZI,{children:"Dataset linked from Shopify"})]}):null]})]}),(0,a.jsx)(w.BT,{className:"text-muted-foreground text-sm",children:l.description})]}),(0,a.jsxs)("div",{className:"-mb-1 -ml-2 flex flex-wrap gap-1",children:[(0,a.jsxs)(n.m_,{children:[(0,a.jsx)(n.k$,{asChild:!0,children:(0,a.jsxs)(eC,{children:[(0,a.jsx)(eN.A,{className:"h-4 w-4 shrink-0"}),"".concat(l.usersCount," ").concat(1===l.usersCount?"user":"users")]})}),(0,a.jsxs)(n.ZI,{collisionPadding:8,children:[l.usersCount," ",1===l.usersCount?"user has":"users have"," requested access to this dataset"]})]}),(0,a.jsxs)(n.m_,{children:[(0,a.jsx)(n.k$,{asChild:!0,children:(0,a.jsxs)(eC,{children:[(0,a.jsx)(ey.A,{className:"h-4 w-4 shrink-0"}),l.requestsCount," requests"]})}),(0,a.jsxs)(n.ZI,{children:[l.requestsCount," total access",1===l.requestsCount?" request":" requests"]})]}),(0,a.jsxs)(n.m_,{children:[(0,a.jsx)(n.k$,{asChild:!0,children:(0,a.jsxs)(eC,{children:[(0,a.jsx)(ew.A,{className:"h-4 w-4 shrink-0"}),"Updated ",(0,r.fF)(l.lastUpdated.toISOString())]})}),(0,a.jsxs)(n.ZI,{children:["Last updated on"," ",l.lastUpdated.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),(0,a.jsxs)(n.m_,{children:[(0,a.jsx)(n.k$,{asChild:!0,children:(0,a.jsxs)(eC,{children:[(0,a.jsx)(eD.A,{className:"h-4 w-4 shrink-0"}),l.size]})}),(0,a.jsxs)(n.ZI,{children:["The dataset is ",l.size," in size"]})]})]}),l.permissions.length>0?(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:l.permissions.map((e,t)=>(0,a.jsx)(ev.E,{variant:"outline",className:"bg-muted text-xs",children:e},t))}):null]}),(0,a.jsx)("div",{className:"mr-2 flex flex-col justify-end",children:(null==(s=l.source)?void 0:s.type)==="shopify"?(0,a.jsx)(eA,{dataset:l}):null}),(0,a.jsx)(i,{data:l.activityData})]})})}var eE=s(9449);function e$(e){let{...t}=e;return(0,a.jsx)(eE.bL,{"data-slot":"dropdown-menu",...t})}function eL(e){let{...t}=e;return(0,a.jsx)(eE.l9,{"data-slot":"dropdown-menu-trigger",...t})}function eF(e){let{className:t,sideOffset:s=4,...n}=e;return(0,a.jsx)(eE.ZL,{children:(0,a.jsx)(eE.UC,{"data-slot":"dropdown-menu-content",sideOffset:s,className:(0,r.cn)("max-h-(--radix-dropdown-menu-content-available-height) origin-(--radix-dropdown-menu-content-transform-origin) z-50 min-w-32 overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})})}function eR(e){let{className:t,inset:s,variant:n="default",...i}=e;return(0,a.jsx)(eE.q7,{"data-slot":"dropdown-menu-item","data-inset":s,"data-variant":n,className:(0,r.cn)("[svg]:*:data-[variant=destructive]:text-destructive! outline-hidden relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm focus:bg-accent focus:text-accent-foreground data-disabled:pointer-events-none data-inset:pl-8 data-[variant=destructive]:text-destructive data-disabled:opacity-50 data-[variant=destructive]:focus:bg-destructive/10 data-[variant=destructive]:focus:text-destructive dark:data-[variant=destructive]:focus:bg-destructive/20 [&_svg:not([class*='size-'])]:size-4 [&_svg:not([class*='text-'])]:text-muted-foreground [&_svg]:pointer-events-none [&_svg]:shrink-0",t),...i})}var e_=s(4616),eq=s(2148),eI=s(3837);function eU(e){let{open:t,onOpenChange:s}=e,n=(0,I.jE)(),r=(0,em.mN)({resolver:(0,ed.u)(en),defaultValues:{name:"",url:"",pat:"",description:""}}),{setError:i}=r,l=(0,U.n)({mutationFn:ei.addShopifyDataset,onError:e=>{e instanceof el.ZM&&i(e.loc,{message:e.message}),e instanceof el.hD&&(0,ex.oR)("Error",{description:e.message})},onSuccess:()=>(s(!1),r.reset(),(0,ex.oR)("Imported data from Shopify"),n.invalidateQueries({queryKey:["datasets"]}))}),{isPending:d}=l;return(0,a.jsx)(P,{open:t,onOpenChange:s,children:(0,a.jsxs)(W,{className:"sm:max-w-md",children:[(0,a.jsx)(Q,{children:(0,a.jsx)(H,{children:"Import data from your Shopify store"})}),(0,a.jsx)(X.lV,{...r,children:(0,a.jsxs)("form",{onSubmit:r.handleSubmit(function(e){l.mutate(e)}),className:"flex flex-col gap-5",children:[(0,a.jsx)(X.zB,{name:"name",render:e=>{let{field:t}=e;return(0,a.jsxs)(X.eI,{children:[(0,a.jsxs)("div",{className:"relative w-full",children:[(0,a.jsx)(X.lR,{children:"Dataset Name *"}),(0,a.jsx)(X.C5,{className:"absolute top-1 right-0"})]}),(0,a.jsx)(X.MJ,{children:(0,a.jsx)(ee.p,{placeholder:"shopify_data",...t})})]})}}),(0,a.jsx)(X.zB,{name:"description",render:e=>{let{field:t}=e;return(0,a.jsxs)(X.eI,{children:[(0,a.jsx)(X.lR,{children:"Description (optional)"}),(0,a.jsx)(X.MJ,{children:(0,a.jsx)(et,{placeholder:"Data from ...",...t})})]})}}),(0,a.jsx)(X.zB,{name:"url",render:e=>{let{field:t}=e;return(0,a.jsxs)(X.eI,{children:[(0,a.jsxs)("div",{className:"relative w-full",children:[(0,a.jsx)(X.lR,{children:"Shopify Store URL *"}),(0,a.jsx)(X.C5,{className:"absolute top-1 right-0"})]}),(0,a.jsx)(X.MJ,{children:(0,a.jsx)(ee.p,{placeholder:"https://your-store.com",...t})})]})}}),(0,a.jsx)(X.zB,{name:"pat",render:e=>{let{field:t}=e;return(0,a.jsxs)(X.eI,{children:[(0,a.jsxs)("div",{className:"relative w-full",children:[(0,a.jsx)(X.lR,{children:"Access Token *"}),(0,a.jsx)(X.C5,{className:"absolute top-1 right-0"})]}),(0,a.jsx)(X.MJ,{children:(0,a.jsx)(ee.p,{placeholder:"shpat_123...",...t})})]})}}),(0,a.jsxs)(Y,{children:[(0,a.jsx)(m.$,{type:"button",variant:"outline",onClick:()=>{s(!1),r.reset()},disabled:d,children:"Cancel"}),(0,a.jsx)(m.$,{type:"submit",disabled:d,children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ec.A,{className:"h-4 w-4 animate-spin"}),"Importing..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eI.A,{className:"h-4 w-4"}),"Import"]})})]})]})})]})})}var eM=s(2714),eZ=s(4395),eO=s(9869),eJ=s(4331);function eP(e){let{open:t,onOpenChange:s,onSuccess:n}=e,[r,i]=(0,l.useState)(null),[d,u]=(0,l.useState)(null),[x,h]=(0,l.useState)(""),[p,f]=(0,l.useState)(""),[j,g]=(0,l.useState)(!1),[v,b]=(0,l.useState)(""),{isDragging:N,activeDropZone:y,handleDragEnter:w,handleDragLeave:D,handleDragOver:k,handleDrop:C}=(0,eJ.J)(),S=(0,I.jE)(),A=(0,U.n)({mutationFn:q.K.createDataset,onSuccess:e=>{S.invalidateQueries({queryKey:["datasets"]}),ex.oR.success("New dataset created"),null==n||n()}}),z=e=>{C(e,"create-dataset",e=>{i(e),h(e.name.replace(/\.[^/.]+$/,""))})},E=async e=>{if(e.preventDefault(),!r)return void b("Please select a file");if(!x.trim())return void b("Please enter a dataset name");if(!d)return void b("Mock dataset file is required");g(!0),b("");try{let e=new FormData;e.append("dataset",r),e.append("name",x.trim()),e.append("description",p.trim()||""),e.append("mock_dataset",d),A.mutate(e)}catch(e){b(e instanceof Error?e.message:"Failed to create dataset")}finally{g(!1)}},$=e=>{e||j||(i(null),u(null),h(""),f(""),b(""),g(!1)),s(e)};return(0,a.jsx)(P,{open:t,onOpenChange:$,children:(0,a.jsxs)(W,{className:"sm:max-w-md",onDragEnter:e=>w(e,"create-dataset"),onDragLeave:e=>D(e,"create-dataset"),onDragOver:e=>k(e,"create-dataset"),onDrop:z,children:[(0,a.jsxs)(Q,{children:[(0,a.jsx)(H,{children:"Create New Dataset"}),(0,a.jsx)(G,{children:"Get started by uploading your dataset file."})]}),(0,a.jsxs)("form",{onSubmit:E,className:"space-y-4",onDragEnter:e=>w(e,"create-dataset"),onDragLeave:e=>D(e,"create-dataset"),onDragOver:e=>k(e,"create-dataset"),onDrop:z,children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(eM.J,{htmlFor:"dataset-file",children:"Dataset File *"}),(0,a.jsxs)("div",{className:"relative rounded-lg border-2 border-dashed p-6 text-center transition-colors ".concat("create-dataset"===y&&N?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-muted-foreground/50"),children:[(0,a.jsx)("input",{id:"dataset-file",type:"file",onChange:e=>{let t=e.target.files;if(t&&t.length>0){i(t[0]);let e=t[0];e.webkitRelativePath?h(e.webkitRelativePath.split("/")[0]):h(e.name.replace(/\.[^/.]+$/,""))}},className:"hidden"}),(0,a.jsx)("label",{htmlFor:"dataset-file",className:"block cursor-pointer",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(eZ.A,{className:"text-muted-foreground mx-auto h-8 w-8"}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"text-primary font-medium hover:underline",children:"create-dataset"===y&&N?"Drop your file here":"Drop your file here or click to select"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-1",children:"Choose your dataset file"})]})]})})]}),r&&(0,a.jsxs)("p",{className:"text-muted-foreground text-sm",children:["Selected: ",r.name]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(eM.J,{htmlFor:"mock-dataset-file",children:"Mock Dataset File *"}),(0,a.jsxs)("div",{className:"relative rounded-lg border-2 border-dashed p-6 text-center transition-colors ".concat("create-mock-dataset"===y&&N?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-muted-foreground/50"),onDragEnter:e=>w(e,"create-mock-dataset"),onDragLeave:e=>D(e,"create-mock-dataset"),onDragOver:e=>k(e,"create-mock-dataset"),onDrop:e=>{C(e,"create-mock-dataset",e=>{u(e)})},children:[(0,a.jsx)("input",{id:"mock-dataset-file",type:"file",onChange:e=>{let t=e.target.files;t&&t.length>0&&u(t[0])},className:"hidden"}),(0,a.jsx)("label",{htmlFor:"mock-dataset-file",className:"block cursor-pointer",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(eZ.A,{className:"text-muted-foreground mx-auto h-8 w-8"}),(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("span",{className:"text-primary font-medium hover:underline",children:"create-mock-dataset"===y&&N?"Drop your mock file here":"Drop your mock file here or click to select"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-1",children:"Choose your mock dataset file"})]})]})})]}),d&&(0,a.jsxs)("p",{className:"text-muted-foreground text-sm",children:["Selected: ",d.name]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(eM.J,{htmlFor:"name",children:"Dataset Name *"}),(0,a.jsx)(ee.p,{id:"name",value:x,onChange:e=>h(e.target.value),placeholder:"Enter dataset name",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(eM.J,{htmlFor:"description",children:"Description (optional)"}),(0,a.jsx)(ee.p,{id:"description",value:p,onChange:e=>f(e.target.value),placeholder:"Brief description of the dataset"})]}),v&&(0,a.jsx)(o,{variant:"destructive",children:(0,a.jsx)(c,{className:"break-all",children:v})}),(0,a.jsxs)(Y,{children:[(0,a.jsx)(m.$,{type:"button",variant:"outline",onClick:()=>$(!1),disabled:j,children:"Cancel"}),(0,a.jsx)(m.$,{type:"submit",disabled:j,children:j?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ec.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eO.A,{className:"mr-2 h-4 w-4"}),"Create Dataset"]})})]})]})]})})}function eT(){let[e,t]=(0,l.useState)(!1),[s,n]=(0,l.useState)(!1);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(e$,{children:[(0,a.jsx)(eL,{asChild:!0,children:(0,a.jsxs)(m.$,{size:"sm",children:[(0,a.jsx)(e_.A,{}),"Add a Dataset"]})}),(0,a.jsxs)(eF,{align:"end",children:[(0,a.jsxs)(eR,{className:"cursor-pointer px-3",onSelect:()=>n(!0),children:[(0,a.jsx)(eq.A,{className:"size-4"}),"Add from a local file"]}),(0,a.jsxs)(eR,{className:"cursor-pointer px-3",onSelect:()=>t(!0),children:[(0,a.jsx)(ek.M2,{className:"size-4"}),"Import from Shopify"]})]})]}),(0,a.jsx)(eU,{open:e,onOpenChange:t}),(0,a.jsx)(eP,{open:s,onOpenChange:n,onSuccess:()=>n(!1)})]})}function eK(){let[e,t]=(0,l.useState)(null),[s,n]=(0,l.useState)(!1),{isPending:r,data:i}=(0,ej.I)({queryKey:["datasets"],queryFn:()=>ei.getDatasets()});return(0,l.useEffect)(()=>{if(!e||!i)return;let s=i.datasets.find(t=>t.uid===e.uid);s&&t(s)},[i]),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Datasets"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Manage your cooperative's data assets"})]}),(0,a.jsx)(eT,{})]}),r||!i?(0,a.jsx)(eV,{}):(0,a.jsx)("div",{className:"space-y-4",children:0===i.datasets.length?(0,a.jsxs)("div",{className:"mx-auto flex h-96 max-w-md flex-col items-center justify-center",children:[(0,a.jsx)(eg.A,{className:"text-muted-foreground mb-6 size-16",strokeWidth:1.5}),(0,a.jsx)("h3",{className:"text-foreground text-lg font-medium",children:"No datasets found"}),(0,a.jsx)("p",{className:"text-muted-foreground mb-6",children:"Add a new dataset to get started"})]}):i.datasets.map(e=>(0,a.jsx)(ez,{dataset:e,onSelect:()=>{t(e),n(!0)}},e.uid))}),(0,a.jsx)(ep,{dataset:e,open:s,onOpenChange:()=>{n(!1),setTimeout(()=>t(null),350)}})]})}function eV(){return(0,a.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0].map((e,t)=>(0,a.jsx)(w.Zp,{children:(0,a.jsxs)(w.Wu,{className:"flex justify-between p-6",children:[(0,a.jsxs)("div",{className:"flex w-2/3 flex-col justify-between gap-1",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(ef.E,{className:"bg-muted h-6 w-1/3 rounded"}),(0,a.jsx)(ef.E,{className:"bg-muted h-4 w-2/3 rounded"})]}),(0,a.jsxs)("div",{className:"flex h-4 gap-2",children:[(0,a.jsx)(ef.E,{className:"h-full w-20"}),(0,a.jsx)(ef.E,{className:"h-full w-20"}),(0,a.jsx)(ef.E,{className:"h-full w-48"}),(0,a.jsx)(ef.E,{className:"h-full w-20"})]})]}),(0,a.jsx)(ef.E,{className:"bg-muted h-24 w-64 rounded"})]})},t))})}}},e=>{e.O(0,[446,574,530,306,922,913,441,964,358],()=>e(e.s=6853)),_N_E=e.O()}]);