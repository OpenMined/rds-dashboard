[supervisord]
nodaemon=true
user=%(ENV_APP_USER)s
logfile=/tmp/supervisord.log
pidfile=/tmp/supervisord.pid
loglevel=info

[program:syftbox-setup]
command=/app/scripts/setup-syftbox.sh
priority=1
autorestart=false
startsecs=0
stopasgroup=true
killasgroup=true
stdout_logfile=%(ENV_HOME)s/.syftbox/logs/setup.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile=%(ENV_HOME)s/.syftbox/logs/setup.error.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=3

[program:syftbox-client]
command=bash -c 'syftbox --config="$HOME/.syftbox/config.json"'
environment=HOME="%(ENV_HOME)s"
priority=10
autorestart=true
startsecs=5
startretries=3
stopasgroup=true
killasgroup=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
depends_on=syftbox-setup

[program:rds-backend]
command=/app/.venv/bin/uvicorn backend.main:app --host 0.0.0.0 --port %(ENV_API_PORT)s
directory=/app
priority=20
autorestart=true
startsecs=5
startretries=3
stopasgroup=true
killasgroup=true
stdout_logfile=%(ENV_HOME)s/.syftbox/logs/rds-backend.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
stderr_logfile=%(ENV_HOME)s/.syftbox/logs/rds-backend.error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=5
environment=DEBUG="%(ENV_DEBUG)s",API_PORT="%(ENV_API_PORT)s",HOME="%(ENV_HOME)s"
